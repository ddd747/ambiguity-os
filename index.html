<!-- index.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <!-- 关键：允许缩放但限制最小/最大，避免浏览器 UI 频繁弹出 -->
  <meta 
    name="viewport" 
    content="width=device-width, initial-scale=1.0, viewport-fit=cover"
  />
  
  <!-- PWA 必需：让手机可“安装”此网页为 App -->
  <meta name="theme-color" content="#000000">
  <link rel="manifest" href="manifest.json">
  
  <title>AmbiguityOS</title>
  <link rel="stylesheet" href="styles/main.css">


  <!-- 预加载开机音效 -->
  <audio id="door-audio" src="assets/sounds/door-open.mp3" preload="auto"></audio>
  <audio id="startup-audio" src="assets/sounds/startup-sound.mp3" preload="auto"></audio>
  <!-- 其他 meta -->
  <link rel="icon" type="image/x-icon" href="assets/icons/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="assets/icons/icon-192.png">
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
  <script src="scripts/main.js" defer></script>
  <script src="scripts/music.js" defer></script>
</head>

<!-- 我的电脑窗口 -->
<div id="my-computer-window" class="window-container hidden">
  <div class="app-window">
    <div class="window-titlebar">
      <span>我的电脑</span>
      <button class="window-close" data-target="my-computer-window">×</button>
    </div>
    <div class="window-content">
      <div class="drive-list">
        <div class="drive-item" data-drive="a">3.5 英寸软盘 (A:)</div>
        <div class="drive-item drive-c" data-drive="c">本地磁盘 (C:)</div>
        <div class="drive-item" data-drive="d">DVD 驱动器 (D:)</div>
        <div class="drive-item" data-drive="e">AmbiguityOS (E:)</div>
      </div>
      <div class="system-info">
        <p>处理器：Living Core v1.0</p>
        <p>内存：∞ MB（与你共享）</p>
      </div>
    </div>
  </div>
</div>

<!-- 回收站窗口 -->
<div id="recycle-bin-window" class="window-container hidden">
  <div class="app-window">
    <div class="window-titlebar">
      <span>回收站</span>
      <button class="window-close" data-target="recycle-bin-window">×</button>
    </div>
    <div class="window-content recycle-content">
      <p style="text-align:center; color:#666; padding-top:40px;">
        回收站是现在空的。
      </p>
    </div>
  </div>
</div>

<!-- Internet Explorer 窗口 -->
<div id="ie-window" class="window-container hidden">
  <div class="app-window">
    <div class="window-titlebar ie-titlebar">
      <span>Internet Explorer</span>
      <button class="window-close" data-target="ie-window">×</button>
    </div>
    <div class="ie-toolbar">
      <button class="ie-btn">←</button>
      <button class="ie-btn">→</button>
      <button class="ie-btn">↻</button>
      <input type="text" value="about:blank" class="ie-address" placeholder="输入网址">
    </div>
    <div class="window-content ie-content">
      <div class="ie-logo">e</div>
      <p>无法显示网页</p>
      <p>Living OS 未连接外部网络。</p>
      <p style="margin-top:20px; font-size:12px; color:#666;">
        提示：本系统仅支持本地共生协议。
      </p>
    </div>
  </div>
</div>

<!-- 舍友聊天窗口 -->
<div id="roommate-chat" class="system-dialog hidden">
  <div class="dialog-title">talking</div>
  <div class="dialog-body">
    <p>Window: “你想聊什么？或者……直接进入《歧义裂隙》？”</p>
    <div style="margin-top: 16px;">
      <textarea id="chat-input" placeholder="输入你想说的话..." rows="3"
        style="width: 100%; padding: 8px; font-family: 'Courier New', monospace;"></textarea>
      <div style="margin-top: 8px; display: flex; gap: 10px;">
        <button id="send-chat">发送</button>
        <button id="launch-gap" style="background: #0a246a; color: white;">启动《歧义裂隙》</button>
      </div>
    </div>
  </div>
  <button id="close-chat">确定</button>
</div>

<body>
  <div class="retro-pc">
    <div class="screen" id="terminal">
      <!-- 终端内容将由 script.js 动态生成 -->
    </div>
    <div class="scanlines"></div>
  </div>

  <div id="window-dialog" class="window-dialog hidden">
    <div class="dialog-header">Window.say</div>
    <div class="dialog-body">
      <p id="window-message-text">
          你好啊，同学。<br>
          以后我们就住在一起啦<br>
          希望你不介意偶尔蓝屏<br>
              (●'◡'●)
      </p>
      <button id="accept-btn">[ 接受协议 ]</button>
    </div> 
  </div>

<!-- 开机动画 -->
<div id="boot-screen" class="hidden">
  <div class="boot-logo">
    <img src="assets/images/logo.png" alt="AmbiguityOS">
  </div>
  <div class="progress-container">
    <div class="progress-bar">
      <div class="progress-fill" id="progress-fill"></div>
    </div>
  </div>
</div>

  <!-- 桌面背景 -->
<div id="desktop" class="desktop hidden">
  <img src="assets/images/bliss.jpg" alt="Bliss" class="bliss-wallpaper">

 <!-- 桌面图标 -->
<div class="desktop-icons">
  <div class="icon" data-app="my-computer">
    <div class="icon-img">
      <svg viewBox="0 0 48 48" width="48" height="48">
        <rect x="4" y="8" width="40" height="28" rx="2" fill="#4a90e2" stroke="#2a6bbd" stroke-width="2"/>
        <rect x="16" y="4" width="16" height="8" rx="1" fill="#357abd"/>
        <circle cx="24" cy="22" r="2" fill="#fff"/>
      </svg>
    </div>
    <span>我的电脑</span>
  </div>

  <div class="icon" data-app="recycle-bin">
    <div class="icon-img">
      <svg viewBox="0 0 48 48" width="48" height="48">
        <path d="M10,42 L38,42 L38,16 L10,16 Z" fill="#7ed321" stroke="#5ab51a" stroke-width="2"/>
        <rect x="14" y="10" width="20" height="6" rx="1" fill="#7ed321" stroke="#5ab51a" stroke-width="2"/>
        <path d="M18,20 L18,38 M24,20 L24,38 M30,20 L30,38" stroke="#5ab51a" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </div>
    <span>回收站</span>
  </div>

  <div class="icon" data-app="internet-explorer">
    <div class="icon-img">
      <svg viewBox="0 0 48 48" width="48" height="48">
        <circle cx="24" cy="24" r="20" fill="#f5a623" stroke="#d08700" stroke-width="2"/>
        <text x="24" y="30" text-anchor="middle" font-family="Arial" font-size="24" fill="#fff" font-weight="bold">e</text>
      </svg>
    </div>
    <span>Internet Explorer</span>
  </div>

  <!-- 在你的 .desktop-icons 中替换最后一项 -->
  <div class="icon" data-app="network-neighbors">
    <div class="icon-img">
      <svg viewBox="0 0 48 48" width="48" height="48">
        <!-- 左侧电脑 -->
        <rect x="6" y="12" width="12" height="8" rx="1" fill="#4a90e2" stroke="#2a6bbd" stroke-width="1.5"/>
        <rect x="10" y="8" width="4" height="4" rx="0.5" fill="#357abd"/>
        <!-- 右侧电脑 -->
        <rect x="30" y="12" width="12" height="8" rx="1" fill="#4a90e2" stroke="#2a6bbd" stroke-width="1.5"/>
        <rect x="34" y="8" width="4" height="4" rx="0.5" fill="#357abd"/>
        <!-- 连接线 -->
        <path d="M18,16 L30,16" stroke="#5ab51a" stroke-width="2" stroke-linecap="round"/>
        <circle cx="24" cy="16" r="2" fill="#5ab51a"/>
        <!-- 底部文件共享符号 -->
        <path d="M16,28 L32,28 L32,36 L16,36 Z" fill="none" stroke="#7ed321" stroke-width="1.5"/>
        <path d="M16,32 L32,32" stroke="#7ed321" stroke-width="1"/>
      </svg>
    </div>
    <span>网络邻居</span>
  </div>

  <!-- 任务栏 -->
<div class="taskbar">
  <div class="start-button">
    <svg class="windows-logo" viewBox="0 0 16 16" width="16" height="16">
      <rect x="1" y="1" width="6" height="6" fill="#fff"/>
      <rect x="9" y="1" width="6" height="6" fill="#fff"/>
      <rect x="1" y="9" width="6" height="6" fill="#fff"/>
      <rect x="9" y="9" width="6" height="6" fill="#fff"/>
    </svg>
    <span>开始</span>
  </div>

  <!-- 👇 新增：动态窗口按钮区 -->
  <div id="taskbar-windows" style="display: flex; gap: 2px; align-items: center;"></div>

  <div class="clock" id="system-clock">00:00</div>
</div>

<!-- ✅ Window 实体放在这里 -->
  <div id="window-agent" class="window-agent hidden">
    <!-- 替换原来的 .window-body -->
    <div class="window-torso"></div>
    <div class="window-legs">
      <div class="leg left"></div>
      <div class="leg right"></div>
    </div>
    <div class="window-head">
      <svg class="window-face" viewBox="0 0 24 24" width="24" height="24">
        <!-- 默认表情 -->
      </svg>
    </div>
  </div>
 <!-- Window 舍友交互气泡 -->
<div id="window-bubble" class="hidden" style="
  position: absolute;
  background: #ffffc0;
  border: 1px solid #000;
  box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
  padding: 8px;
  z-index: 100;
  font-family: 'Microsoft YaHei', sans-serif;
  font-size: 14px;
">
  <ul class="bubble-options" style="list-style: none; padding: 0; margin: 0;">
    <li data-action="chat" style="padding: 4px 0; cursor: pointer;">💬 和舍友聊天</li>
    <li data-action="move-to-window" style="padding: 4px 0; cursor: pointer;">🏠 移到窗边</li>
  </ul>
</div>

  <!-- 旋转提示（仅竖屏） -->
  <div id="rotate-prompt" class="rotate-prompt">
    <p>请旋转屏幕至横向模式</p>
    <p>以获得完整操作系统体验</p>
    <p style="font-size:12px; margin-top:12px; opacity:0.7;">
    💡 提示：点击浏览器菜单 → “添加到主屏幕”，可全屏运行
  </div>

  <div id="browser-warning" class="browser-warning hidden">
  ⚠️ 当前浏览器限制较多，建议使用 Chrome / Safari 获得完整体验
</div>

  <!-- 开始菜单面板 -->
<div id="start-menu" class="start-menu hidden">
  <div class="menu-header">
    <div class="user-name">舍友</div>
    <span class="logo-text">AmbiguityGap</span>
  </div>
  <div class="menu-content">
    <div class="menu-items-wrapper">
    <div class="menu-section folders">
      <div class="menu-item" data-app="documents">​​📄​ 我的文档</div>
      <div class="menu-item" data-app="videos">🎬 视频</div>
      <div class="menu-item" data-app="pictures">🖼️ 图片</div>
      <div class="menu-item" data-app="downloads">​​🛂​ 下载</div>
      <div class="menu-item" data-app="music">🎵 音乐</div>
    </div>
    <div class="menu-section programs">
      <div class="menu-item" data-action="launch" data-app="ambiguity-gap">​​​🔞​《歧义裂隙》</div>
      <div class="menu-item" data-action="launch" data-app="notepad">​​​📝​记事本</div>
      <div class="menu-item" data-action="launch" data-app="calc">🖩计算器</div>
      <div class="menu-item" data-action="re-setup">🔧 重新运行初始设置</div>
    </div>
  </div>
  <!-- 👇 翻页按钮（默认隐藏） -->
  <button class="menu-nav-btn prev hidden">◀</button>
  <button class="menu-nav-btn next">▶</button>
  </div>
</div>

<!-- Window 横屏提示弹窗 -->
<div id="window-message" class="system-dialog hidden">
  <div class="dialog-title">Window.say</div>
  <div class="dialog-body">
  Ciallo～(∠· ω <)⌒★<br>
  横过来了？<br>
  我就知道你会配合。
  </div>
  <button id="msg-close">确定</button>
</div>

  <script type="module" src="./scripts/main.js"></script>
  <!-- PWA 安装提示条 -->
<div id="install-hint" class="install-hint hidden">
  <span>💡 将 AmbiguityOS 添加到主屏幕，获得完整体验</span>
  <button id="install-btn">安装</button>
  <button id="dismiss-install">×</button>
</div>

<!-- 下载窗口 -->
<div id="downloads-window" class="window-container hidden">
  <div class="app-window">
    <div class="window-titlebar">
      🛂 下载
      <span class="window-close" data-target="downloads-window">×</span>
    </div>
    <div class="window-content">
      <p>新舍友会出现在这里。</p>
      <p>双击 .exe 文件以添加舍友。</p>
      <div id="downloads-list">
        <!-- 动态生成 -->
        <div class="folder-item disabled">目前暂无登记哦！@w@</div>
      </div>
    </div>
  </div>
</div>

<!-- 我的文档窗口 -->
<div id="documents-window" class="window-container hidden">
  <div class="app-window">
    <div class="window-titlebar">
      📄 我的文档
      <span class="window-close" data-target="documents-window">×</span>
    </div>
    <div class="window-content">
      <p>技能说明、日志、配置文件存放于此。</p>
      <ul>
        <li><a href="#" onclick="openSkillDoc('current')">📄 当前角色技能说明.txt</a></li>
        <li>📝 session.log</li>
        <li>⚙️ preferences.ini</li>
      </ul>
    </div>
  </div>
</div>

<!-- 音乐窗口 -->
<div id="music-window" class="window-container hidden">
  <div class="app-window">
    <div class="window-titlebar">
      🎵 音乐
      <span class="window-close" data-target="music-window">×</span>
    </div>
    <div class="window-content">
      <p>背景音乐会随角色 HP% 变化音量的哦。</p>
      <button id="upload-bgm-btn">上传本地音频</button>
      <button id="toggle-bgm-btn">⏸️/▶️</button>
      <span id="bgm-status">⏹️ 未播放</span>
    </div>
  </div>
</div>

<!-- 视频窗口 -->
<div id="videos-window" class="window-container hidden">
  <div class="app-window">
    <div class="window-titlebar">
      🎬 视频
      <span class="window-close" data-target="videos-window">×</span>
    </div>
    <div class="window-content">
      <p>实时状态监控面板</p>
      <div id="status-monitor">
        <p>当前角色：<span id="monitor-char">未选择</span></p>
        <p>回合数：<span id="monitor-turn">--</span></p>
      </div>
    </div>
  </div>
</div>

<!-- 进程选择器窗口 -->
<div id="process-selector-container" class="window-container hidden">
  <!-- 👇 关键：添加 class="compact-window" -->
  <div class="app-window compact-window">
    <div class="window-titlebar" style="background: linear-gradient(to bottom, #000080, #000040); color: white; padding: 4px 8px; font-weight: bold;">
      进程选择器
      <span class="window-close">×</span>
    </div>
    <div class="window-content" style="padding: 16px; background: #c0c0c0; font-family: 'Microsoft YaHei', sans-serif;">
      <p>请选择一个主角色：</p>
      <div id="character-list" style="margin: 10px 0;"></div>
      <div style="text-align: right; margin-top: 12px;">
        <button id="confirm-select-btn" style="width: 70px; background: #d4d0c8; border: 1px solid #000; padding: 3px 8px; cursor: pointer;">确定</button>
        <button id="cancel-select-btn" style="width: 70px; background: #d4d0c8; border: 1px solid #000; padding: 3px 8px; cursor: pointer;">取消</button>
      </div>
    </div>
  </div>
</div>

<!-- 网络邻居窗口 -->
<div id="network-neighbors-window" class="window-container hidden">
  <div class="app-window" style="width: 360px; height: auto; min-height: 220px;">
    <div class="window-titlebar" style="background: linear-gradient(to bottom, #008000, #004000); color: white; padding: 4px 8px; font-weight: bold;">
      网络邻居
      <span class="window-close" data-target="network-neighbors-window">×</span>
    </div>
    <div class="window-content" style="padding: 16px; background: #c0c0c0; font-family: 'Microsoft YaHei', sans-serif;">
      <p>在局域网中查找《歧义裂隙》房间：</p>
      
      <div style="margin: 12px 0;">
        <button id="create-room-btn" style="width: 100%; background: #d4d0c8; border: 1px solid #000; padding: 6px; margin-bottom: 8px;">
          🆕 创建新房间
        </button>
        
        <div style="display: flex; gap: 6px; margin-top: 8px;">
          <input type="text" id="join-room-id" placeholder="输入房间ID" style="flex:1; padding: 4px; border: 1px solid #888;">
          <button id="join-room-btn" style="width: 80px; background: #d4d0c8; border: 1px solid #000; padding: 4px;">
            加入
          </button>
        </div>
      </div>
      
      <p style="font-size: 12px; color: #555; margin-top: 12px;">
        💡 房间ID 可通过聊天、短信等方式分享给队友。
      </p>
    </div>
  </div>
</div>

</div>
<!-- 3D Window 舍友容器 -->
<div id="window-3d-container" class="window-3d-container hidden"></div>
<!-- Window 姿势驱动器 (D:) -->
<div id="pose-editor-container" class="window-container hidden">
  <div class="app-window">
  <div class="window-titlebar">
    Window 姿势驱动器 (D:)
    <span class="window-close" data-target="pose-editor-container">×</span>
  </div>
  <div class="window-content">
    <p>调整骨骼参数以校准 Window 的肢体协议。</p>
    
    <!-- 骨骼选择区 -->
    <div style="margin: 10px 0;">
      <label><strong>添加骨骼控制：</strong></label><br>
      <select id="bone-selector"></select>
      <select id="axis-selector">
        <option value="x">X 轴</option>
        <option value="y">Y 轴</option>
        <option value="z">Z 轴</option>
      </select>
      <button id="add-bone-control">+</button>
    </div>

    <!-- 动态滑块容器 -->
    <div id="dynamic-sliders" style="max-height: 300px; overflow-y: auto;"></div>

    <!-- 相机 X -->
<div class="pose-slider-group">
  <label>相机 X</label>
  <input type="range" id="cam-x" min="-5" max="5" step="0.1" class="slider desktop-only">
  <input type="number" id="cam-x-input" min="-5" max="5" step="0.1" class="numeric mobile-only">
  <span id="cam-x-val">0.00</span>
</div>

<!-- 相机 Y -->
<div class="pose-slider-group">
  <label>相机 Y</label>
  <input type="range" id="cam-y" min="0" max="3" step="0.1" class="slider desktop-only">
  <input type="number" id="cam-y-input" min="0" max="3" step="0.1" class="numeric mobile-only">
  <span id="cam-y-val">1.50</span>
</div>

<!-- 相机 Z -->
<div class="pose-slider-group">
  <label>相机 Z</label>
  <input type="range" id="cam-z" min="2" max="10" step="0.1" class="slider desktop-only">
  <input type="number" id="cam-z-input" min="2" max="10" step="0.1" class="numeric mobile-only">
  <span id="cam-z-val">5.00</span>
</div>

    <div style="margin-top: 15px;">
      <button id="pose-save-btn">💾 保存为默认</button>
      <!-- D盘窗口内 -->
      <button id="save-named-pose-btn">💿刻录为CD并命名</button>
      <button id="pose-reset-btn">🔄 重置为 T-pose</button>
      <button id="load-cd-btn">📀 加载一张新的CD</button>
      <!-- 新增：中文化切换 -->
      <label class="toggle-switch">
      <input type="checkbox" id="chinese-bone-names-toggle">
        <span class="slider"></span>
        <span class="label-text">📑骨骼名称中文化</span>
      </label>
      <button id="edit-mapping-btn">✏️ 你的舍友好像不一样？</button>
      <!-- 舍友选择器 -->
      <div style="margin-top: 10px;">
        <label><strong>更换舍友：</strong></label><br>
        <select id="roommate-selector"></select>
        <button id="apply-roommate-btn">🔄 应用</button>
      </div>
    </div>
  </div>
  </div>
</div>
<!-- A: 软盘窗口 -->
<div id="a-drive-window" class="window-container hidden">
  <div class="app-window compact-window">
    <div class="window-titlebar">
      <span>3.5 英寸软盘 (A:)</span>
      <button class="window-close" data-target="a-drive-window">×</button>
    </div>
    <div class="window-content">
      <p>💾 软盘驱动器为空。</p>
      <p>请插入 AmbiguityOS 启动盘。</p>
    </div>
  </div>
</div>

<!-- C: 本地磁盘窗口 -->
<div id="c-drive-window" class="window-container hidden">
  <div class="app-window compact-window">
    <div class="window-titlebar">
      <span>本地磁盘 (C:)</span>
      <button class="window-close" data-target="c-drive-window">×</button>
    </div>
    <div class="window-content">
      <p>📁 系统目录</p>
      <ul>
        <li>Windows/</li>
        <li>Program Files/</li>
        <li>Roommates/</li>
        <li>LivingCore/</li>
      </ul>
      <p style="margin-top: 16px; color: #666;">💡 这是 Living Core 的虚拟系统盘。</p>
    </div>
  </div>
</div>

</body>
</html>